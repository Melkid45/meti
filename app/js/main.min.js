gsap.set(".cursor",{xPercent:-50,yPercent:-50}),$(document).mousemove((function(e){gsap.to(".cursor",{x:e.clientX,y:e.clientY,duration:.1,ease:"power1.out"})})),$(document).on("mouseenter","a",(function(){console.log($(this).attr("href"));let e=$(this).attr("href");$(".default_text").fadeIn(200),e.includes("tel")?($(".default_text").text("Позвонить"),$(".cursor .phone").css({scale:"1"}),$(".cursor svg").not(".cursor .arrow").css({scale:0})):e.includes("mail")?($(".cursor .mail").css({scale:"1"}),$(".cursor svg").not(".cursor .arrow").css({scale:0}),$(".default_text").text("Написать")):($(".default_text").text("Клик"),$(".cursor .arrow").css({scale:"1"}),$(".cursor svg").not(".cursor .arrow").css({scale:0}))})).on("mouseleave","a",(function(){$(".cursor svg").css({scale:"0"}),$(".default_text").fadeOut(200)})),$(document).on({mouseleave:function(){$(".cursor svg").css("scale","0"),$(".default_text").fadeOut(200)},mousemove:function(){updateVideoCursor()},click:function(e){e.preventDefault(),toggleVideoPlayback()}},".showreel");const video=document.querySelector(".showreel__video");function toggleVideoPlayback(){video&&(video.paused||video.ended?video.play().catch((e=>console.error("Video play error:",e))):video.pause(),updateVideoCursor())}function updateVideoCursor(){if(!video)return;const e=!video.paused&&!video.ended,t=$(".cursor");t.find(".pause").css("scale",e?"1":"0"),t.find(".play").css("scale",e?"0":"1"),$(".default_text").fadeIn(200),$(".default_text").text(e?"Пауза":"воспроизвести")}function onEntry(e){e.forEach((e=>{e.isIntersecting&&e.target.classList.add("element-show")}))}let options={threshold:[.5]},observer=new IntersectionObserver(onEntry,options),elements=document.querySelectorAll(".element-animation");for(let e of elements)observer.observe(e);let lastScrollTop=0;window.addEventListener("scroll",(function(){let e=window.pageYOffset||document.documentElement.scrollTop;e>lastScrollTop?document.querySelector(".header").classList.add("back"):document.querySelector(".header").classList.remove("back"),lastScrollTop=e<=0?0:e})),document.addEventListener("DOMContentLoaded",(()=>{const e={squareSize:40,gap:0,fillColor:"#000000",bgColor:"#F4F4F403",animationDuration:2e3},t=document.getElementById("grid-canvas-begin"),i=t.getContext("2d");let o=[],s=[],r=0;function a(){const i=document.querySelector(".main");t.width=i.clientWidth,t.height=i.clientHeight;const a=Math.ceil(t.width/(e.squareSize+e.gap)),l=Math.ceil(t.height/(e.squareSize+e.gap));o=Array(a*l).fill().map(((t,i)=>{const o=i%a,s=Math.floor(i/a);return{x:o*(e.squareSize+e.gap),y:s*(e.squareSize+e.gap),width:e.squareSize,height:e.squareSize,filled:!1}})),s=[...Array(o.length).keys()],function(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}}(s),r=0,n()}function n(){i.clearRect(0,0,t.width,t.height),o.forEach((t=>{i.fillStyle=t.filled?e.fillColor:e.bgColor,i.fillRect(t.x,t.y,t.width,t.height)}))}const l=new ScrollMagic.Controller;new ScrollMagic.Scene({triggerElement:".main",duration:e.animationDuration,triggerHook:0}).setPin(".main").on("progress",(e=>{!function(e){if(e<r)for(let t=r-1;t>=e;t--)t>=0&&t<s.length&&(o[s[t]].filled=!1);else for(let t=r;t<e;t++)t>=0&&t<s.length&&(o[s[t]].filled=!0);r=e,n()}(Math.floor(e.progress*o.length))})).addTo(l),a(),window.addEventListener("resize",(()=>{a(),l.update()}))}));const canvas=document.getElementById("pixelCanvas"),ctx=canvas.getContext("2d"),img=new Image;function initCanvas(){canvas.width=img.width,canvas.height=img.height,renderPixelated(20)}function renderPixelated(e){ctx.imageSmoothingEnabled=!1,ctx.clearRect(0,0,canvas.width,canvas.height);const t=Math.floor(canvas.width/e),i=Math.floor(canvas.height/e);ctx.drawImage(img,0,0,t,i),ctx.drawImage(canvas,0,0,t,i,0,0,canvas.width,canvas.height)}img.src="../images/dist/about.webp",img.onload=function(){initCanvas(),window.addEventListener("resize",initCanvas);const e={pixelSize:20};gsap.to(e,{scrollTrigger:{trigger:".about",start:"top top",end:"bottom bottom",scrub:!0},pixelSize:1,onUpdate:function(){renderPixelated(e.pixelSize)}})};class DynamicGrid{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.cellPool=[],this.activeCells=[],this.mouse={x:-1e3,y:-1e3},this.lastMouse={x:-1e3,y:-1e3},this.velocity={x:0,y:0},this.settings={baseSize:60,sizeVariation:0,spacing:0,activationRadius:120,fadeSpeed:.02,maxRotation:0,rotationSpeed:0,borderColor:{r:244,g:244,b:244,a:.24},fillColor:{r:0,g:0,b:0,a:0}},this.resize(),this.initPool(),this.bindEvents(),this.animate()}resize(){this.width=this.canvas.width=window.innerWidth,this.height=this.canvas.height=window.innerHeight,this.gridCols=Math.ceil(this.width/(this.settings.baseSize+this.settings.spacing)),this.gridRows=Math.ceil(this.height/(this.settings.baseSize+this.settings.spacing))}initPool(){for(let e=0;e<this.gridRows;e++)for(let t=0;t<this.gridCols;t++){const i=this.settings.baseSize+(Math.random()-.5)*this.settings.sizeVariation;this.cellPool.push({x:t*(this.settings.baseSize+this.settings.spacing),y:e*(this.settings.baseSize+this.settings.spacing),width:i,height:i,rotation:(Math.random()-.5)*this.settings.maxRotation,targetRotation:0,alpha:0,active:!1,lastActiveTime:0,borderWidth:1})}}bindEvents(){window.addEventListener("resize",(()=>this.resize())),document.querySelector(".about").addEventListener("mousemove",(e=>{this.lastMouse.x=this.mouse.x,this.lastMouse.y=this.mouse.y,this.mouse.x=e.clientX,this.mouse.y=e.clientY,this.velocity.x=this.mouse.x-this.lastMouse.x,this.velocity.y=this.mouse.y-this.lastMouse.y})),document.querySelector(".about").addEventListener("mouseout",(()=>{this.mouse.x=-1e3,this.mouse.y=-1e3}))}updateCells(){const e=performance.now(),t=this.settings.activationRadius*this.settings.activationRadius;for(let i of this.cellPool){const o=this.mouse.x-(i.x+i.width)+30,s=this.mouse.y-(i.y+i.height)+90;o*o+s*s<t?(i.active=!0,i.lastActiveTime=e,i.targetRotation=.2*Math.atan2(this.velocity.y,this.velocity.x),i.alpha=Math.min(1)):(i.active&&e-i.lastActiveTime>300&&(i.active=!1),i.alpha=Math.max(0,i.alpha-this.settings.fadeSpeed),i.targetRotation=0),i.rotation+=(i.targetRotation-i.rotation)*this.settings.rotationSpeed}}draw(){this.ctx.clearRect(0,0,this.width,this.height);for(let e of this.cellPool)e.alpha<=0||(this.ctx.save(),this.ctx.translate(e.x+e.width/2,e.y+e.height/2),this.ctx.rotate(e.rotation),this.ctx.fillStyle=`rgba(${this.settings.fillColor.r}, ${this.settings.fillColor.g}, ${this.settings.fillColor.b}, ${this.settings.fillColor.a*e.alpha})`,this.ctx.fillRect(-e.width/2,-e.height/2,e.width,e.height),this.ctx.strokeStyle=`rgba(${this.settings.borderColor.r}, ${this.settings.borderColor.g}, ${this.settings.borderColor.b}, ${this.settings.borderColor.a*e.alpha})`,this.ctx.lineWidth=e.borderWidth,this.ctx.strokeRect(-e.width/2,-e.height/2,e.width,e.height),this.ctx.restore())}animate(){this.updateCells(),this.draw(),requestAnimationFrame((()=>this.animate()))}}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("gridCanvas");new DynamicGrid(e)}));const GRID_SIZE=14,CELL_SIZE=40,SHAPES={heart:[[1,6],[1,5],[1,4],[2,3],[3,2],[4,2],[5,3],[6,4],[7,4],[8,3],[9,2],[10,2],[11,3],[12,4],[12,5],[12,6],[11,7],[10,8],[9,9],[8,10],[7,11],[6,11],[5,10],[4,9],[3,8],[2,7]],sound:[[6,11],[5,10],[4,9],[3,8],[2,8],[1,8],[1,7],[1,6],[1,5],[2,5],[3,5],[4,4],[5,3],[6,2],[6,3],[6,4],[6,5],[6,6],[6,7],[6,8],[6,9],[6,10],[8,9],[9,9],[10,8],[10,7],[10,6],[10,5],[9,4],[8,4],[8,11],[9,11],[10,11],[11,10],[12,9],[12,8],[12,7],[12,6],[12,5],[12,4],[11,3],[10,2],[9,2],[8,2]],glass:[[6,7],[6,6],[7,6],[7,7],[0,6],[0,7],[1,5],[2,4],[3,3],[4,3],[5,2],[6,2],[7,2],[8,2],[9,3],[10,3],[11,4],[12,5],[13,6],[13,7],[12,8],[11,9],[10,10],[9,10],[8,11],[7,11],[6,11],[5,11],[4,10],[3,10],[2,9],[1,8]],cmile:[[1,8],[1,7],[1,6],[1,5],[2,4],[2,3],[3,2],[4,2],[5,1],[6,1],[7,1],[8,1],[9,2],[10,2],[11,3],[11,4],[12,5],[12,6],[12,7],[12,8],[11,9],[11,10],[10,11],[9,11],[8,12],[7,12],[6,12],[5,12],[4,11],[3,11],[2,10],[2,9],[5,6],[5,5],[5,4],[8,6],[8,5],[8,4],[4,8],[5,9],[6,9],[7,9],[8,9],[9,8]],kind:[[8,1],[7,1],[6,1],[5,1],[4,2],[3,2],[2,3],[2,4],[1,5],[1,6],[1,7],[1,8],[2,9],[2,10],[3,11],[4,11],[5,12],[6,12],[7,12],[8,12],[9,11],[10,11],[11,10],[11,9],[12,8],[12,7],[12,6],[12,5],[10,2],[10,3],[11,3],[9,4],[8,5],[7,6],[6,6],[6,7],[7,7],[6,4],[5,4],[4,5],[4,6],[4,7],[4,8],[5,9],[6,9],[7,9],[8,9],[9,8],[9,7]],creative:[[8,1],[7,2],[7,3],[7,4],[7,5],[7,6],[7,7],[6,8],[5,7],[5,6],[5,5],[4,5],[6,5],[4,8],[3,7],[3,6],[3,5],[3,4],[2,3],[1,4],[1,5],[1,6],[1,7],[1,8],[1,9],[2,10],[3,11],[4,12],[5,12],[6,12],[7,12],[8,11],[9,11],[10,10],[11,9],[11,8],[12,7],[12,6],[12,5],[11,5],[10,6],[9,6],[9,7],[9,5],[9,4],[9,3],[9,2]],camera:[[1,2],[2,2],[3,2],[4,2],[5,2],[6,2],[7,2],[8,2],[8,3],[8,4],[8,5],[8,6],[8,7],[8,8],[8,9],[8,10],[8,11],[7,11],[6,11],[5,11],[4,11],[3,11],[2,11],[1,11],[1,10],[1,9],[1,8],[1,7],[1,6],[1,5],[1,4],[1,3],[9,5],[10,4],[11,3],[12,2],[12,3],[12,4],[12,5],[12,6],[12,7],[12,8],[12,9],[12,10],[12,11],[11,10],[10,9],[9,8]],photo:[[1,3],[2,3],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3],[9,3],[10,3],[11,3],[12,3],[12,4],[12,5],[12,6],[12,7],[12,8],[12,9],[12,10],[12,11],[11,11],[10,11],[9,11],[8,11],[7,11],[6,11],[5,11],[4,11],[3,11],[2,11],[1,11],[1,10],[1,9],[1,8],[1,7],[1,6],[1,5],[1,4],[3,2],[4,2],[8,6],[9,6],[10,7],[10,8],[9,9],[8,9],[7,8],[7,7]],arrow:[[1,12],[1,11],[1,10],[2,9],[3,8],[4,7],[5,6],[6,5],[7,4],[8,3],[9,2],[10,1],[12,1],[11,0],[13,2],[12,3],[11,4],[10,5],[9,6],[8,7],[7,8],[6,9],[5,10],[4,11],[3,12],[2,12],[3,10],[10,3]]},TITLES=["Спецпроекты","Smm","Аналитика","influence marketing","Стратегии","Креатив","видео-продакшн","фото-продакшн","дизайн и брендинг"],svg=document.getElementById("interactive-grid"),colors=["#442CBF"];for(let e=0;e<14;e++)for(let t=0;t<14;t++){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x",40*t),i.setAttribute("y",40*e),i.setAttribute("width",40),i.setAttribute("height",40),i.setAttribute("stroke","#272727"),i.setAttribute("fill","transparent"),i.classList.add("cell"),Object.keys(SHAPES).forEach((o=>{SHAPES[o].some((i=>i[0]===t&&i[1]===e))&&(i.dataset[o]="true")})),svg.appendChild(i)}const titlesContainer=document.querySelector(".services__body-block-titles"),titles=Array.from(titlesContainer.querySelectorAll("h3")),descContainer=document.querySelector(".services__body-block-desc"),desc=Array.from(descContainer.querySelectorAll("p"));gsap.set(titles,{opacity:0,display:"none"}),gsap.set(desc,{opacity:0,display:"none"}),gsap.ticker.lagSmoothing(0),ScrollTrigger.normalizeScroll(!0);const masterTL=gsap.timeline({scrollTrigger:{trigger:".services",start:"top -5.5%",end:"+=1000%",scrub:.5,pin:!0,onEnter:()=>masterTL.play(),onLeave:()=>masterTL.progress(1),onEnterBack:()=>masterTL.play(),onLeaveBack:()=>masterTL.progress(0),fastScrollEnd:!0}});if(masterTL.scrollTrigger){const e=ScrollTrigger.getById(masterTL.scrollTrigger.id);e&&e.progress>.9&&masterTL.progress(1)}let lastScrollTime=0;window.addEventListener("scroll",(()=>{const e=Date.now();if(e-lastScrollTime<50&&masterTL.scrollTrigger){const e=ScrollTrigger.getById(masterTL.scrollTrigger.id);e&&e.progress>.9&&masterTL.progress(1),e&&e.progress<.1&&masterTL.progress(0)}lastScrollTime=e}));const numberElement=document.getElementById("number");Object.keys(SHAPES).forEach(((e,t)=>{const i=gsap.utils.toArray(`[data-${e}="true"]`),o=titles[t],s=titles[t-1],r=desc[t],a=desc[t-1];masterTL.to(".cell",{fill:"transparent",duration:.2,ease:"power2.inOut"},`shape-${t}-start`),s&&a&&masterTL.to([s,a],{opacity:0,display:"none",duration:.3,ease:"power2.in"},">0.1"),masterTL.call((()=>{const e=(t+1).toString().padStart(2,"0");gsap.fromTo(numberElement,{y:-10,opacity:0},{y:0,opacity:1,duration:.5,innerText:e,snap:{innerText:1},ease:"back.out(1.2)",modifiers:{innerText:function(e){return parseInt(e).toString().padStart(2,"0")}}})}),null,">0.1"),masterTL.to(o,{opacity:1,display:"block",duration:.5,ease:"power2.out"},"<"),masterTL.to(r,{opacity:1,display:"block",duration:.5,ease:"power2.out"},"<"),masterTL.to(i,{fill:"#442CBF",duration:1.2,ease:"back.out(1.2)",stagger:{each:.05,from:"center"}},">0.3"),masterTL.to({},{duration:.5},">")})),masterTL.eventCallback("onComplete",(()=>{masterTL.progress(0).pause(),ScrollTrigger.refresh()})),document.addEventListener("DOMContentLoaded",(()=>{const e={squareSize:40,gap:0,fillColor:"#F4F4F403",bgColor:"#000000",batchSize:50,fillSpeed:.5},t=new ScrollMagic.Controller,i=document.getElementById("grid-canvas-video"),o=i.getContext("2d");let s=[],r=[],a=0;function n(){const t=document.querySelector(".showreel");i.width=t.clientWidth,i.height=t.clientHeight;const o=Math.ceil(i.width/(e.squareSize+e.gap)),n=Math.ceil(i.height/(e.squareSize+e.gap));s=Array(o*n).fill().map(((t,i)=>{const s=i%o,r=Math.floor(i/o);return{x:s*(e.squareSize+e.gap),y:r*(e.squareSize+e.gap),width:e.squareSize,height:e.squareSize,filled:!1}})),r=[...Array(s.length).keys()].sort((()=>Math.random()-.5)),a=0,l()}function l(){o.clearRect(0,0,i.width,i.height),s.forEach((t=>{o.fillStyle=t.filled?e.fillColor:e.bgColor,o.fillRect(t.x,t.y,t.width,t.height)}))}new ScrollMagic.Scene({triggerElement:".showreel",duration:"400%",triggerHook:0}).setPin(".showreel").on("progress",(function(e){!function(e){const t=Math.floor(e*s.length*2);if(t<=s.length){const e=Math.min(t,s.length);for(let t=0;t<e;t++)s[r[t]].filled||(s[r[t]].filled=!0);for(let t=e;t<s.length;t++)s[r[t]].filled=!1}else{const e=Math.min(t-s.length,s.length);for(let t=0;t<e;t++)s[r[s.length-1-t]].filled&&(s[r[s.length-1-t]].filled=!1);for(let t=e;t<s.length;t++)s[r[s.length-1-t]].filled=!0}l()}(e.progress)})).addTo(t),n(),window.addEventListener("resize",(()=>{n(),t.update()}))})),gsap.ticker.lagSmoothing(0),ScrollTrigger.normalizeScroll(!0),document.addEventListener("DOMContentLoaded",(()=>{const e=new ScrollMagic.Controller,t=gsap.fromTo(".case__soft",{y:"150%"},{y:"-350%",ease:Linear.easeNone});new ScrollMagic.Scene({triggerElement:".case",triggerHook:0,duration:"400%",offset:0}).setTween(t).setPin(".case").addTo(e)})),document.addEventListener("DOMContentLoaded",(()=>{const e={squareSize:40,gap:0,fillColor:"#442CBF",bgColor:"#000000",animationDuration:2e3,maxSpeed:.1},t=document.getElementById("feedback-grid-canvas"),i=t.getContext("2d");let o=[],s=[],r=0,a=0,n=0,l=0,c=null;function d(){const i=document.querySelector(".feedback__top");t.width=i.clientWidth,t.height=i.clientHeight;const n=Math.floor(t.width/(e.squareSize+e.gap)),l=Math.floor(t.height/(e.squareSize+e.gap));o=Array(n*l).fill().map(((t,i)=>({x:i%n*(e.squareSize+e.gap),y:Math.floor(i/n)*(e.squareSize+e.gap),width:e.squareSize,height:e.squareSize,filled:!1}))),s=[...Array(o.length).keys()];for(let e=s.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}r=0,a=0,h()}function h(){i.clearRect(0,0,t.width,t.height),o.forEach((t=>{i.fillStyle=t.filled?e.fillColor:e.bgColor,i.fillRect(t.x,t.y,t.width,t.height)}))}function g(){if(a<r){const e=Math.min(r-a,50);for(let t=0;t<e;t++){const e=s[a+t];o[e].filled=!0}a+=e}else if(a>r){const e=Math.min(a-r,50);for(let t=0;t<e;t++){const e=s[a-t-1];o[e].filled=!1}a-=e}h(),c=a!==r?requestAnimationFrame(g):null}const u=new ScrollMagic.Controller;new ScrollMagic.Scene({triggerElement:".feedback__top",duration:e.animationDuration,triggerHook:0}).setPin(".feedback__top").on("progress",(t=>{const i=performance.now(),s=i-n;n=i;const a=t.progress-l,d=s>0?Math.abs(a)/(s/1e3):0;l=t.progress;const h=d>1e3*e.maxSpeed?l+Math.sign(a)*e.maxSpeed*(s/1e3):t.progress;r=Math.floor(h*o.length),c||(c=requestAnimationFrame(g))})).addTo(u),d();const m=new ResizeObserver((()=>{cancelAnimationFrame(c),c=null,d(),u.update()}));m.observe(document.querySelector(".feedback__top")),window.addEventListener("beforeunload",(()=>{cancelAnimationFrame(c),m.disconnect()}))}));